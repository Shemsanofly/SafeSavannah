<div class="map-container">
  <!-- Map Controls -->
  <div class="map-controls">
    <div class="control-group">
      <h3 class="text-sm font-medium text-gray-700 mb-2">Map Layers</h3>
      <div class="flex flex-wrap gap-2">
        <button 
          (click)="toggleTracks()"
          [class]="showTracks ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
          class="px-3 py-1 text-xs font-medium rounded-md hover:bg-blue-700 transition-colors duration-200">
          {{ showTracks ? 'Hide' : 'Show' }} Tracks
        </button>
        <button 
          (click)="toggleZones()"
          [class]="showZones ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'"
          class="px-3 py-1 text-xs font-medium rounded-md hover:bg-green-700 transition-colors duration-200">
          {{ showZones ? 'Hide' : 'Show' }} Zones
        </button>
        <button 
          (click)="toggleAlerts()"
          [class]="showAlerts ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'"
          class="px-3 py-1 text-xs font-medium rounded-md hover:bg-red-700 transition-colors duration-200">
          {{ showAlerts ? 'Hide' : 'Show' }} Alerts
        </button>
      </div>
    </div>

    <div class="control-group">
      <h3 class="text-sm font-medium text-gray-700 mb-2">Quick Actions</h3>
      <div class="flex flex-wrap gap-2">
        <button 
          (click)="fitAllAnimals()"
          class="px-3 py-1 text-xs font-medium bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200">
          Fit All Animals
        </button>
      </div>
    </div>

    <!-- Animal Selection -->
    <div class="control-group" *ngIf="animals.length > 0">
      <h3 class="text-sm font-medium text-gray-700 mb-2">Track Animal</h3>
      <div class="space-y-1">
        <button 
          *ngFor="let animal of animals"
          (click)="centerOnAnimal(animal.id)"
          [class]="selectedAnimal?.id === animal.id ? 'bg-blue-100 border-blue-500' : 'bg-white border-gray-300'"
          class="w-full text-left px-2 py-1 text-xs border rounded-md hover:bg-gray-50 transition-colors duration-200">
          <div class="flex items-center justify-between">
            <span class="font-medium">{{ animal.name }}</span>
            <span class="text-gray-500">{{ animal.species.split(' ')[0] }}</span>
          </div>
          <div class="flex items-center justify-between text-gray-400">
            <span>{{ animal.health }}</span>
            <span *ngIf="animal.batteryLevel" 
                  [class]="animal.batteryLevel < 20 ? 'text-red-500' : animal.batteryLevel < 50 ? 'text-yellow-500' : 'text-green-500'">
              ðŸ”‹ {{ animal.batteryLevel?.toFixed(0) }}%
            </span>
          </div>
        </button>
      </div>
    </div>

    <!-- Active Alerts Summary -->
    <div class="control-group" *ngIf="alerts.length > 0">
      <h3 class="text-sm font-medium text-gray-700 mb-2">Active Alerts ({{ alerts.length }})</h3>
      <div class="space-y-1 max-h-40 overflow-y-auto">
        <div 
          *ngFor="let alert of alerts | slice:0:5"
          class="p-2 border-l-4 bg-gray-50 text-xs"
          [class]="'border-' + (alert.priority === 'critical' ? 'red' : alert.priority === 'high' ? 'orange' : alert.priority === 'medium' ? 'yellow' : 'green') + '-500'">
          <div class="font-medium">{{ alert.title }}</div>
          <div class="text-gray-600 mt-1">{{ alert.location.name || 'Unknown location' }}</div>
          <div class="text-gray-500 mt-1">{{ getTimeAgo(alert.timestamp) }}</div>
        </div>
        <div *ngIf="alerts.length > 5" class="text-xs text-gray-500 text-center py-1">
          ... and {{ alerts.length - 5 }} more
        </div>
      </div>
    </div>
  </div>

  <!-- Main Map -->
  <div id="map" class="map-view"></div>

  <!-- Selected Animal Info Panel -->
  <div *ngIf="selectedAnimal" class="animal-info-panel">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg font-bold text-gray-800">{{ selectedAnimal.name }}</h3>
      <button (click)="selectedAnimal = null" class="text-gray-500 hover:text-gray-700" title="Close animal info panel">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="space-y-3">
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="font-medium text-gray-600">Species:</span>
          <div class="text-gray-800">{{ selectedAnimal.species }}</div>
        </div>
        <div>
          <span class="font-medium text-gray-600">Health:</span>
          <div class="text-gray-800 capitalize">{{ selectedAnimal.health }}</div>
        </div>
        <div *ngIf="selectedAnimal.age">
          <span class="font-medium text-gray-600">Age:</span>
          <div class="text-gray-800">{{ selectedAnimal.age }} years</div>
        </div>
        <div *ngIf="selectedAnimal.gender">
          <span class="font-medium text-gray-600">Gender:</span>
          <div class="text-gray-800 capitalize">{{ selectedAnimal.gender }}</div>
        </div>
      </div>

      <div class="border-t pt-3">
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div *ngIf="selectedAnimal.speed">
            <span class="font-medium text-gray-600">Speed:</span>
            <div class="text-gray-800">{{ selectedAnimal.speed.toFixed(1) }} km/h</div>
          </div>
          <div *ngIf="selectedAnimal.batteryLevel">
            <span class="font-medium text-gray-600">Battery:</span>
            <div class="text-gray-800" 
                 [class]="selectedAnimal.batteryLevel < 20 ? 'text-red-600' : selectedAnimal.batteryLevel < 50 ? 'text-yellow-600' : 'text-green-600'">
              {{ selectedAnimal.batteryLevel.toFixed(0) }}%
            </div>
          </div>
        </div>
      </div>

      <div class="border-t pt-3">
        <span class="font-medium text-gray-600 text-sm">Last Seen:</span>
        <div class="text-gray-800 text-sm">{{ selectedAnimal.lastSeen | date:'medium' }}</div>
      </div>

      <div class="border-t pt-3">
        <span class="font-medium text-gray-600 text-sm">Position:</span>
        <div class="text-gray-800 text-xs font-mono">
          {{ selectedAnimal.position.latitude.toFixed(6) }}, {{ selectedAnimal.position.longitude.toFixed(6) }}
        </div>
      </div>

      <div *ngIf="selectedAnimal.collarId" class="border-t pt-3">
        <span class="font-medium text-gray-600 text-sm">Collar ID:</span>
        <div class="text-gray-800 text-sm">{{ selectedAnimal.collarId }}</div>
      </div>

      <div *ngIf="selectedAnimal.conservationStatus" class="border-t pt-3">
        <span class="font-medium text-gray-600 text-sm">Conservation Status:</span>
        <div class="text-gray-800 text-sm capitalize" 
             [class]="selectedAnimal.conservationStatus === 'endangered' ? 'text-red-600' : selectedAnimal.conservationStatus === 'vulnerable' ? 'text-orange-600' : 'text-green-600'">
          {{ selectedAnimal.conservationStatus }}
        </div>
      </div>
    </div>
  </div>
</div>