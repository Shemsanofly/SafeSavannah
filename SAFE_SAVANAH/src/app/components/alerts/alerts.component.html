<div class="alerts-container">
  <!-- Header with Stats and Controls -->
  <div class="alerts-header">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">Alerts Dashboard</h2>
        <p class="text-gray-600 mt-1">Real-time wildlife monitoring alerts</p>
      </div>
      <div class="flex items-center space-x-4">
        <!-- Sound Controls -->
        <div class="sound-controls">
          <button 
            (click)="toggleSound()"
            [class]="soundEnabled ? 'px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700' : 'px-3 py-2 bg-gray-400 text-white rounded-md hover:bg-gray-500'"
            [title]="soundEnabled ? 'Sounds enabled - click to disable' : 'Sounds disabled - click to enable'">
            {{ soundEnabled ? '🔊' : '🔇' }}
          </button>
          
          <div class="dropdown relative inline-block">
            <button 
              (click)="showSoundDropdown = !showSoundDropdown"
              class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 dropdown-toggle"
              title="Test animal sounds">
              🎵 Animal Sounds
            </button>
            <div [class]="showSoundDropdown ? 'dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-10' : 'dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-10 hidden'">
              <div class="py-1">
                <div class="px-4 py-2 text-xs text-gray-500 border-b border-gray-100">
                  🎵 Animal Sound Library
                </div>
                <button 
                  *ngFor="let animal of Object.keys(animalSounds)" 
                  (click)="playAnimalSound(animal); showSoundDropdown = false"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center justify-between">
                  <span>🦁 {{ animal | titlecase }}</span>
                  <span [class]="getSoundFileStatus(animal) === 'real' ? 'text-xs text-green-600' : 'text-xs text-orange-600'">
                    {{ getSoundFileStatus(animal) === 'real' ? '🎧 Real' : '🎛️ Synth' }}
                  </span>
                </button>
                <div class="border-t border-gray-100"></div>
                <button 
                  (click)="testAllAnimalSounds(); showSoundDropdown = false"
                  class="block w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 font-medium">
                  🎼 Play All Sounds
                </button>
                <div class="px-4 py-2 text-xs text-gray-500 border-t border-gray-100">
                  <div>📁 Add real sound files to assets/sounds/</div>
                  <div>🔄 Synth sounds used as fallback</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <button 
          (click)="exportAlerts()"
          class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200"
          title="Export alerts to JSON">
          📥 Export
        </button>
        
        <button 
          (click)="generateTestAlert()"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200"
          title="Generate test alert">
          🧪 Test Alert
        </button>
        
        <button 
          (click)="refreshAlerts()"
          class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200"
          title="Refresh alerts">
          🔄 Refresh
        </button>
      </div>
    </div>

    <!-- Alert Statistics -->
    <div class="stats-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="stat-card bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-lg shadow-lg border border-blue-200">
        <div class="text-sm font-medium text-blue-100">Total Alerts</div>
        <div class="text-2xl font-bold text-white mt-1">{{ alertStats?.total || 0 }}</div>
        <div class="text-xs text-blue-200 mt-1">All time</div>
      </div>
      <div class="stat-card bg-gradient-to-r from-red-600 to-red-700 text-white p-4 rounded-lg shadow-lg border border-red-200">
        <div class="text-sm font-medium text-red-100">Unread</div>
        <div class="text-2xl font-bold text-white mt-1">{{ alertStats?.unread || 0 }}</div>
        <div class="text-xs text-red-200 mt-1">Need attention</div>
      </div>
      <div class="stat-card bg-gradient-to-r from-orange-600 to-orange-700 text-white p-4 rounded-lg shadow-lg border border-orange-200">
        <div class="text-sm font-medium text-orange-100">Today</div>
        <div class="text-2xl font-bold text-white mt-1">{{ alertStats?.todayCount || 0 }}</div>
        <div class="text-xs text-orange-200 mt-1">Last 24h</div>
      </div>
      <div class="stat-card bg-gradient-to-r from-green-600 to-green-700 text-white p-4 rounded-lg shadow-lg border border-green-200">
        <div class="text-sm font-medium text-green-100">This Week</div>
        <div class="text-2xl font-bold text-white mt-1">{{ alertStats?.weekCount || 0 }}</div>
        <div class="text-xs text-green-200 mt-1">Last 7 days</div>
      </div>
    </div>

    <!-- Priority Breakdown -->
    <div class="priority-breakdown bg-white border border-gray-200 rounded-lg p-4 mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Priority Breakdown</h3>
      <div class="grid grid-cols-4 gap-4">
        <div class="text-center">
          <div class="text-sm text-gray-600">Critical</div>
          <div class="text-lg font-bold text-red-600">{{ alertStats.byPriority.critical }}</div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-600">High</div>
          <div class="text-lg font-bold text-orange-600">{{ alertStats.byPriority.high }}</div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-600">Medium</div>
          <div class="text-lg font-bold text-yellow-600">{{ alertStats.byPriority.medium }}</div>
        </div>
        <div class="text-center">
          <div class="text-sm text-gray-600">Low</div>
          <div class="text-lg font-bold text-green-600">{{ alertStats.byPriority.low }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section bg-white border border-gray-200 rounded-lg p-4 mb-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Filter Alerts</h3>
    
    <div class="filters-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <!-- Priority Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
        <select 
          [(ngModel)]="selectedPriority" 
          (change)="applyFilters()"
          class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option *ngFor="let option of priorityOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Type Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
        <select 
          [(ngModel)]="selectedType" 
          (change)="applyFilters()"
          class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option *ngFor="let option of typeOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Read Status Filter -->
      <div class="flex items-center">
        <label class="flex items-center">
          <input 
            type="checkbox" 
            [(ngModel)]="showOnlyUnread" 
            (change)="applyFilters()"
            class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
          <span class="text-sm">Unread only</span>
        </label>
      </div>

      <!-- Active Status Filter -->
      <div class="flex items-center">
        <label class="flex items-center">
          <input 
            type="checkbox" 
            [(ngModel)]="showOnlyActive" 
            (change)="applyFilters()"
            class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
          <span class="text-sm">Active only</span>
        </label>
      </div>

      <!-- Clear Filters -->
      <button 
        (click)="clearFilters()"
        class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors duration-200">
        Clear Filters
      </button>

      <!-- Mark All as Read -->
      <button 
        *ngIf="alertStats.unread > 0"
        (click)="markAllAsRead()"
        class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
        Mark All Read
      </button>
    </div>

    <!-- Results Info -->
    <div class="flex justify-between items-center text-sm text-gray-600 mb-4">
      <span>{{ paginationInfo }}</span>
      <span *ngIf="filteredAlerts.length !== alerts.length">
        (Filtered from {{ alerts.length }} total alerts)
      </span>
    </div>
  </div>

  <!-- Alerts List -->
  <div class="alerts-list">
    <div *ngIf="paginatedAlerts.length === 0" class="no-alerts text-center py-12">
      <div class="text-6xl mb-4">🦌</div>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">No Alerts Found</h3>
      <p class="text-gray-500">{{ alerts.length === 0 ? 'No alerts available. The wildlife monitoring system is running smoothly.' : 'No alerts match your current filters. Try adjusting your search criteria.' }}</p>
    </div>

    <div *ngFor="let alert of paginatedAlerts; trackBy: trackAlert" 
         class="alert-card bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm hover:shadow-md transition-shadow duration-200"
         [class.border-red-300]="alert.priority === 'critical'"
         [class.border-orange-300]="alert.priority === 'high'"
         [class.border-yellow-300]="alert.priority === 'medium'"
         [class.border-green-300]="alert.priority === 'low'"
         [class.bg-blue-50]="!alert.isRead">
      
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <div class="flex items-center space-x-3 mb-2">
            <span class="text-2xl">{{ getAlertIcon(alert.type) }}</span>
            <div>
              <h4 class="text-lg font-semibold text-gray-900">{{ alert.title }}</h4>
              <p class="text-sm text-gray-600">{{ getFormattedSource(alert.source) }} • {{ getTimeAgo(alert.timestamp) }}</p>
            </div>
          </div>
          
          <p class="text-gray-700 mb-3">{{ alert.message }}</p>
          
          <!-- Location and Animal Info -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
            <div *ngIf="alert.location" class="flex items-center text-sm text-gray-600">
              <span class="mr-2">📍</span>
              <span>{{ alert.location.name }} ({{ alert.location.latitude.toFixed(4) }}, {{ alert.location.longitude.toFixed(4) }})</span>
            </div>
            <div *ngIf="alert.metadata && alert.metadata['animalType']" class="flex items-center text-sm text-gray-600">
              <span class="mr-2">🦁</span>
              <span>{{ alert.metadata['animalType'] | titlecase }}</span>
            </div>
          </div>

          <!-- Priority and Status Badges -->
          <div class="flex items-center space-x-2 mb-3">
            <span class="priority-badge px-2 py-1 text-xs font-medium rounded-full"
                  [class]="getPriorityClass(alert.priority)">
              {{ alert.priority | titlecase }}
            </span>
            <span class="status-badge px-2 py-1 text-xs font-medium rounded-full"
                  [class]="alert.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'">
              {{ alert.isActive ? 'Active' : 'Resolved' }}
            </span>
            <span *ngIf="!alert.isRead" class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
              New
            </span>
          </div>

          <!-- Metadata -->
          <div *ngIf="alert.metadata && Object.keys(alert.metadata).length > 0" class="metadata">
            <button 
              (click)="toggleMetadata(alert)"
              class="text-sm text-blue-600 hover:text-blue-800 mb-2">
              {{ getMetadataVisible(alert) ? 'Hide' : 'Show' }} Details
            </button>
            <div *ngIf="getMetadataVisible(alert)" class="bg-gray-50 p-3 rounded-md text-sm">
              <div *ngFor="let item of Object.entries(alert.metadata)" class="mb-1">
                <span class="font-medium">{{ item[0] | titlecase }}:</span>
                <span class="ml-2 text-gray-700">{{ item[1] }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col space-y-2 ml-4">
          <button 
            *ngIf="!alert.isRead"
            (click)="markAsRead(alert)"
            class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200"
            title="Mark as read">
            Mark Read
          </button>
          <button 
            *ngIf="alert.isActive"
            (click)="resolveAlert(alert.id)"
            class="px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200"
            title="Resolve alert">
            Resolve
          </button>
          <button 
            (click)="deleteAlert(alert.id)"
            class="px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200"
            title="Delete alert">
            Delete
          </button>
          <button 
            *ngIf="alert.metadata && alert.metadata['animalType']"
            (click)="playAnimalSound(alert.metadata['animalType'])"
            class="px-3 py-1 text-sm bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors duration-200"
            title="Play animal sound">
            🔊
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="totalPages > 1" class="pagination flex justify-center items-center space-x-2 mt-6">
    <button 
      (click)="currentPage = currentPage - 1; applyFilters()"
      [disabled]="currentPage === 1"
      class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
      Previous
    </button>
    
    <span *ngFor="let page of getPageNumbers()" 
          class="px-3 py-2 text-sm border rounded-md cursor-pointer"
          [class]="page === currentPage ? 'bg-blue-600 text-white border-blue-600' : 'border-gray-300 hover:bg-gray-50'"
          (click)="currentPage = page; applyFilters()">
      {{ page }}
    </span>
    
    <button 
      (click)="currentPage = currentPage + 1; applyFilters()"
      [disabled]="currentPage === totalPages"
      class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
      Next
    </button>
  </div>
</div>